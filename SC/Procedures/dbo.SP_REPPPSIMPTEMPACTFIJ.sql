SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




























/*Importaciones temporales de activo fijo bajo pps*/
CREATE PROCEDURE dbo.SP_REPPPSIMPTEMPACTFIJ ( @DAPCODIGO INT)   as

SET NOCOUNT ON 

DECLARE @TOTIMPTEMP1 decimal(38,6), @TOTIMPTEMP1dlls decimal(38,6)

if exists (select * 	FROM VREPPPSIMPTEMPACTFIJ
	WHERE DAP_CODIGO=@DAPCODIGO)
begin
	DECLARE CUR_DECANUALTIMPTEMP2 CURSOR FOR
	
		SELECT SUM(valor), SUM(PID_CTOT_DLS)
		FROM VREPPPSIMPTEMPACTFIJ
		WHERE DAP_CODIGO=@DAPCODIGO
		GROUP BY DAP_CODIGO 
	
	
	
	OPEN CUR_DECANUALTIMPTEMP2
			
	FETCH NEXT FROM CUR_DECANUALTIMPTEMP2 INTO @TOTIMPTEMP1, @TOTIMPTEMP1dlls
	
	WHILE (@@FETCH_STATUS = 0) 
	BEGIN
	
		if @TOTIMPTEMP1=0 or @TOTIMPTEMP1 is null
		set @TOTIMPTEMP1=@TOTIMPTEMP1dlls
	
	
		UPDATE DECANUALPPS
		SET DAP_IMPTEMPACTFIJ= floor(round(@TOTIMPTEMP1, 0)/1000),  DAP_IMPTEMPACTFIJUSD= floor(round(@TOTIMPTEMP1dlls, 0)/1000)
		WHERE DECANUALPPS.DAP_CODIGO = @DAPCODIGO
	
	
		FETCH NEXT FROM CUR_DECANUALTIMPTEMP2 INTO @TOTIMPTEMP1, @TOTIMPTEMP1dlls
	
	END
	
	
	CLOSE CUR_DECANUALTIMPTEMP2
	DEALLOCATE CUR_DECANUALTIMPTEMP2
end
else
begin
		UPDATE DECANUALPPS
		SET DAP_IMPTEMPACTFIJ=0,  DAP_IMPTEMPACTFIJUSD= 0
		WHERE DECANUALPPS.DAP_CODIGO = @DAPCODIGO

end



























GO
