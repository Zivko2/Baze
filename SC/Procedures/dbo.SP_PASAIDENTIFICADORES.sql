SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




























CREATE PROCEDURE [dbo].[SP_PASAIDENTIFICADORES] (@PI_CODIGO INT, @FC_CODIGO INT)   as

DECLARE @IDE_CODIGO INT, @IDED_CODIGO INT, @FCI_DESC VARCHAR(50), @FCI_DESC2 VARCHAR(50), @CONSECUTIVO INT




	declare cur_factconsidentitica cursor for		SELECT     IDE_CODIGO, IDED_CODIGO, FCI_DESC, FCI_DESC2
		FROM         FACTCONSIDENTIFICA
		WHERE     (FC_CODIGO = @FC_CODIGO) AND IDE_CODIGO NOT IN
			(SELECT IDE_CODIGO FROM PEDIMPIDENTIFICA WHERE PI_CODIGO=@PI_CODIGO)
	open cur_factconsidentitica
	
	
		FETCH NEXT FROM cur_factconsidentitica INTO @IDE_CODIGO, @IDED_CODIGO, @FCI_DESC, @FCI_DESC2
	
		WHILE (@@FETCH_STATUS = 0) 
		BEGIN
	
			EXEC SP_GETCONSECUTIVO @TIPO='PII', @VALUE=@CONSECUTIVO OUTPUT
	
			INSERT INTO PEDIMPIDENTIFICA(PII_CODIGO, PI_CODIGO, IDE_CODIGO, IDED_CODIGO, PII_DESC, PII_DESC2)
			VALUES(@CONSECUTIVO, @PI_CODIGO, @IDE_CODIGO, @IDED_CODIGO, @FCI_DESC, @FCI_DESC2)
	
	
		FETCH NEXT FROM cur_factconsidentitica INTO @IDE_CODIGO, @IDED_CODIGO, @FCI_DESC, @FCI_DESC2
	
	END
	
	CLOSE cur_factconsidentitica
	DEALLOCATE cur_factconsidentitica



























GO
