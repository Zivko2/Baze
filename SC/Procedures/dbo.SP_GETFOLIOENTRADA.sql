SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




























CREATE PROCEDURE dbo.SP_GETFOLIOENTRADA(@PRCOD INT, @CFETYPE VARCHAR(2), @TFCOD INT, @TQCOD INT, @FOLIO VARCHAR(15) OUTPUT)   as

BEGIN
DECLARE @PREFIJO    VARCHAR(3);
DECLARE @SUFIJO     VARCHAR(3);
DECLARE @CONTADOR   VARCHAR(32);
DECLARE @OLDCONT VARCHAR(32);

     SELECT  @PREFIJO = CFE_PREFIJO, @CONTADOR = CONVERT(CHAR(32),CFE_CONTADOR), @SUFIJO = CFE_SUFIJO
     FROM CONFIGURAFOLIOENT
     WHERE PR_CODIGO = @PRCOD AND CFE_TIPO = @CFETYPE AND TF_CODIGO = @TFCOD AND TQ_CODIGO = @TQCOD AND CFE_ACTIVO = 'S' AND CFE_PRINCIPAL = 'S'
     -- Fill with 0 diference of lenght in Contador
    SET @OLDCONT = @CONTADOR 
    SET @FOLIO = @PREFIJO + RTRIM(STUFF(@CONTADOR, 1, 9- LEN(@CONTADOR), REPLICATE('0', 9 - LEN(@CONTADOR) ))) + RTRIM(@OLDCONT) + @SUFIJO
    IF @FOLIO IS NULL SET @FOLIO = ''
END



























GO
