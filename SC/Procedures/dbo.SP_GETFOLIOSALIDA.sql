SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




























CREATE PROCEDURE dbo.SP_GETFOLIOSALIDA(@PRCOD INT, @CFSTYPE VARCHAR(2), @TFCOD INT, @TQCOD INT, @FOLIO VARCHAR(15) OUTPUT)   as

BEGIN
DECLARE @PREFIJO   VARCHAR(3);
DECLARE @SUFIJO    VARCHAR(3);
DECLARE @CONTADOR  VARCHAR(32);
DECLARE @OLDCONT VARCHAR(32);

     SELECT  @PREFIJO = CFS_PREFIJO, @CONTADOR = CONVERT(CHAR(32),CFS_CONTADOR), @SUFIJO = CFS_SUFIJO
     FROM CONFIGURAFOLIOSAL
     WHERE CL_CODIGO = @PRCOD AND CFS_TIPO = @CFSTYPE AND TF_CODIGO = @TFCOD AND TQ_CODIGO = @TQCOD AND CFS_ACTIVO = 'S' AND CFS_PRINCIPAL = 'S'
    -- Fill with 0 diference of lenght in Contador
    SET @OLDCONT = @CONTADOR 
    SET @FOLIO = @PREFIJO + RTRIM(STUFF(@CONTADOR, 1, 9- LEN(@CONTADOR), REPLICATE('0', 9 - LEN(@CONTADOR) ))) + RTRIM(@OLDCONT) + @SUFIJO
    IF @FOLIO IS NULL SET @FOLIO = ''
END



























GO
