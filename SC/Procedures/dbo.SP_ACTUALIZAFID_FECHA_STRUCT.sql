SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[SP_ACTUALIZAFID_FECHA_STRUCT] (@FI_codigo int)   as

SET NOCOUNT ON 
declare @owner varchar(150)




	UPDATE FACTIMPDET
	SET FID_FECHA_STRUCT=CASE WHEN (SELECT COUNT(BSU_SUBENSAMBLE) FROM BOM_STRUCT WHERE BSU_SUBENSAMBLE = MA_CODIGO AND BST_PERINI<=FI_FECHA AND BST_PERFIN>=FI_FECHA)>0
		 THEN convert(varchar(10), getdate(),101) ELSE NULL END
	FROM FACTIMPDET INNER JOIN FACTIMP ON FACTIMPDET.FI_CODIGO=FACTIMP.FI_CODIGO
	WHERE FACTIMPDET.FI_CODIGO=@FI_codigo




GO
