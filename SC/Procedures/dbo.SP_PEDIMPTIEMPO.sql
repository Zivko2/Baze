SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




























CREATE PROCEDURE dbo.SP_PEDIMPTIEMPO   as

SET NOCOUNT ON 
BEGIN
  DECLARE @ERRORES INT
  DECLARE @TIEMPO INT, @MESES INT, @DIAS INT
  SET @ERRORES = 0
  BEGIN TRANSACTION
   
  SELECT @DIAS = CF_DIAS_AVISO FROM CONFIGURACION 

SELECT A.AG_PATENTE, P.PI_FOLIO, P.PI_FEC_PAG, CP.CP_CLAVE  FROM VPEDIMP AS P
JOIN CONFIGURATIEMPO AS C ON (C.CP_CODIGO = P.CP_CODIGO)
LEFT OUTER  JOIN CLAVEPED AS CP ON (CP.CP_CODIGO = P.CP_CODIGO)
LEFT OUTER JOIN AGENCIA AS A ON (A.AG_CODIGO = P.AD_DES)


 WHERE PI_FEC_PAG >= DATEADD(day,  -@DIAS , (DATEADD(month,C.COT_TIEMPO,getDate())))

 IF (@@ERROR >0 ) SET @ERRORES = 1

  COMMIT TRAN
  IF @ERRORES = 0
  RETURN(0)
ELSE
BEGIN
     ROLLBACK TRAN
     RETURN(1)
END
END

























GO
