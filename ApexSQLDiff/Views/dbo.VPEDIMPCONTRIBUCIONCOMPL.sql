SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO






CREATE VIEW dbo.VPEDIMPCONTRIBUCIONCOMPL
with encryption as
SELECT     PI_CODIGO, CON_CODIGO, ROUND(SUM(PIT_CONTRIBTOTMN), 0) AS PIT_CONTRIBTOTMN, PG_CODIGO
FROM        (SELECT     isnull(PIB_IMPORTECONTR,0) as PIT_CONTRIBTOTMN, PI_CODIGO, 0 as pg_codigo, (select con_codigo from contribucion where con_clave='12') as con_codigo
	FROM         dbo.PEDIMPDETB
	WHERE PIB_IMPORTECONTR >0
	UNION
	SELECT     isnull(PIB_IMPORTERECARGOS,0) as PIT_CONTRIBTOTMN, PI_CODIGO, 0 as pg_codigo, (select con_codigo from contribucion where con_clave='7') as con_codigo
	FROM         dbo.PEDIMPDETB
	WHERE PIB_IMPORTERECARGOS >0
	UNION
	SELECT SUM(ROUND(PIT_CONTRIBTOTMN, 0))  AS PIT_CONTRIBTOTMN,  PI_CODIGO, PG_CODIGO,  CON_CODIGO
	FROM PEDIMPCONTRIBUCION
	WHERE PIT_TIPO='C'
	GROUP BY PI_CODIGO, CON_CODIGO, PIT_CONTRIBPOR, 
	    PG_CODIGO, TTA_CODIGO
	HAVING SUM(ROUND(PIT_CONTRIBTOTMN, 0))>0
	) PEDIMPCONTRIBUCIONCOMPL1
GROUP BY PI_CODIGO, CON_CODIGO, PG_CODIGO


GO
