SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO


































CREATE VIEW dbo.VDESCARGA
with encryption as
SELECT     dbo.FACTEXP.FE_CODIGO, dbo.BOM_DESCTEMP.FED_INDICED, dbo.BOM_DESCTEMP.BST_HIJO, SUM(dbo.BOM_DESCTEMP.BST_INCORPOR) 
                      AS BST_INCORPOR, ISNULL(dbo.BOM_DESCTEMP.FACTCONV, 1) AS FACTCONV, MAESTRO_1.SE_CODIGO, MAESTRO_2.MA_DEF_TIP, 
                      dbo.BOM_DESCTEMP.BST_TIPODESC, dbo.BOM_DESCTEMP.MA_TIP_ENS, dbo.BOM_DESCTEMP.BST_PERINI, 
                      dbo.BOM_DESCTEMP.BST_TIPOCOSTO, dbo.FACTEXP.FE_FECHA, 'QtyADescargar'=CASE WHEN dbo.BOM_DESCTEMP.BST_TIPOCOSTO='Z' and dbo.BOM_DESCTEMP.TI_CODIGO='E' 
	THEN SUM(dbo.BOM_DESCTEMP.BST_INCORPOR) * ISNULL(dbo.BOM_DESCTEMP.FACTCONV, 1)  else 
	dbo.FACTEXPDET.FED_CANT * SUM(dbo.BOM_DESCTEMP.BST_INCORPOR) * ISNULL(dbo.BOM_DESCTEMP.FACTCONV, 1) END
FROM         dbo.MAESTRO MAESTRO_1 RIGHT OUTER JOIN
                      dbo.FACTEXPDET ON MAESTRO_1.MA_CODIGO = dbo.FACTEXPDET.MA_CODIGO RIGHT OUTER JOIN
                      dbo.BOM_DESCTEMP LEFT OUTER JOIN
                      dbo.MAESTRO MAESTRO_2 ON dbo.BOM_DESCTEMP.BST_HIJO = MAESTRO_2.MA_CODIGO ON 
                      dbo.FACTEXPDET.FED_INDICED = dbo.BOM_DESCTEMP.FED_INDICED RIGHT OUTER JOIN
                      dbo.FACTEXP ON dbo.BOM_DESCTEMP.FE_CODIGO = dbo.FACTEXP.FE_CODIGO
WHERE     (dbo.BOM_DESCTEMP.BST_DISCH = 'S') AND (dbo.FACTEXPDET.FED_CANT > 0)
GROUP BY dbo.FACTEXP.FE_CODIGO, dbo.BOM_DESCTEMP.FED_INDICED, dbo.BOM_DESCTEMP.BST_HIJO, dbo.BOM_DESCTEMP.FACTCONV, 
                      dbo.FACTEXPDET.FED_CANT, MAESTRO_1.SE_CODIGO, MAESTRO_2.MA_DEF_TIP, dbo.BOM_DESCTEMP.BST_TIPODESC, 
                      dbo.BOM_DESCTEMP.MA_TIP_ENS, dbo.BOM_DESCTEMP.BST_PERINI, dbo.BOM_DESCTEMP.BST_TIPOCOSTO, dbo.BOM_DESCTEMP.TI_CODIGO, 
                      dbo.FACTEXP.FE_FECHA
HAVING      (SUM(dbo.BOM_DESCTEMP.BST_INCORPOR) > 0)






























































GO
