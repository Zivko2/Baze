SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




































CREATE VIEW dbo.VBARCODE
with encryption as
SELECT     BARCODE.BC_CODIGO, 'BC_BARCODE'=CASE WHEN isnull(BARCODE.BC_AGRUPACION,'I')='A' THEN BARCODE.BC_BARCODE 
           WHEN (BARCODE.BC_TIPO='F' AND isnull(BARCODE.BC_AGRUPACION,'I')='I' AND BARCODE.BC_TIPOMOV='E') THEN FACTIMP.FI_BARCODE 
           WHEN (BARCODE.BC_TIPO='F' AND isnull(BARCODE.BC_AGRUPACION,'I')='I' AND BARCODE.BC_TIPOMOV='S') THEN FACTEXP.FE_BARCODE 
           WHEN BARCODE.BC_TIPO='P' THEN PEDIMP.PI_BARCODE END, BARCODE.BC_DOCTO, BARCODE.BC_TEXTO, 
          'CANTIDAD'=CASE WHEN (BARCODE.BC_TIPO='F' AND BARCODE.BC_TIPOMOV='E') 
 			THEN (SELECT SUM(FACTIMPDET.FID_CANT_ST * FACTIMPDET.EQ_GEN)FROM FACTIMPDET INNER JOIN FACTIMP ON FACTIMPDET.FI_CODIGO = FACTIMP.FI_CODIGO
			      WHERE FACTIMP.BC_CODIGO = BARCODE.BC_CODIGO) 
                          WHEN (BARCODE.BC_TIPO='F' AND BARCODE.BC_TIPOMOV='S') 
 			THEN (SELECT SUM(FACTEXPDET.FED_CANT * FACTEXPDET.EQ_GEN)FROM FACTEXPDET INNER JOIN FACTEXP ON FACTEXPDET.FE_CODIGO = FACTEXP.FE_CODIGO
			      WHERE FACTEXP.BC_CODIGO = BARCODE.BC_CODIGO)
 	  		ELSE (SELECT SUM(PEDIMPDET.PID_CAN_GEN)FROM PEDIMPDET INNER JOIN PEDIMP ON PEDIMPDET.PI_CODIGO = PEDIMP.PI_CODIGO
  			      WHERE PEDIMP.BC_CODIGO = BARCODE.BC_CODIGO) END,
          'COSTOTOT'=CASE WHEN (BARCODE.BC_TIPO='F' AND BARCODE.BC_TIPOMOV='E') 
 			THEN (SELECT SUM(FACTIMPDET.FID_COS_TOT)FROM FACTIMPDET INNER JOIN FACTIMP ON FACTIMPDET.FI_CODIGO = FACTIMP.FI_CODIGO
			      WHERE FACTIMP.BC_CODIGO = BARCODE.BC_CODIGO) 
                          WHEN (BARCODE.BC_TIPO='F' AND BARCODE.BC_TIPOMOV='S') 
 			THEN (SELECT SUM(FACTEXPDET.FED_COS_TOT)FROM FACTEXPDET INNER JOIN FACTEXP ON FACTEXPDET.FE_CODIGO = FACTEXP.FE_CODIGO
			      WHERE FACTEXP.BC_CODIGO = BARCODE.BC_CODIGO)
 	  		ELSE (SELECT SUM(PEDIMPDET.PID_CTOT_DLS)FROM PEDIMPDET INNER JOIN PEDIMP ON PEDIMPDET.PI_CODIGO = PEDIMP.PI_CODIGO
  			      WHERE PEDIMP.BC_CODIGO = BARCODE.BC_CODIGO) END,
                      BARCODE.BC_NOMBRE,  BARCODE.BC_TIPOMOV, isnull(BARCODE.BC_AGRUPACION,'I') as BC_AGRUPACION, BARCODE.BC_TIPO
FROM         BARCODE LEFT OUTER JOIN
                      PEDIMP ON BARCODE.BC_CODIGO = PEDIMP.BC_CODIGO LEFT OUTER JOIN
                      FACTEXP ON BARCODE.BC_CODIGO = FACTEXP.BC_CODIGO LEFT OUTER JOIN
                      FACTIMP ON BARCODE.BC_CODIGO = FACTIMP.BC_CODIGO




































GO
