SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO













CREATE VIEW dbo.VPEDIMENTOFACTEXP
with encryption as
SELECT    (CASE WHEN TF_CODIGO in (select tf_codigo from tfactura where tf_nombre in ('CAMBIO DE REGIMEN (MERCADO NACIONAL)', 'REGULARIZACION (MATERIAL VENCIDO)', 'REEXPEDICION', 'REEXPEDICION DE ACTIVO FIJO')) THEN
(SELECT PATENTE_FOLIO FROM  VPEDIMP WHERE PI_CODIGO=(CASE WHEN FACTEXP.PI_RECTIFICA>-1 THEN FACTEXP.PI_RECTIFICA ELSE FACTEXP.PI_CODIGO END)) ELSE
(SELECT PATENTE_FOLIO FROM  VPEDEXP WHERE PI_CODIGO=(CASE WHEN FACTEXP.PI_RECTIFICA>-1 THEN FACTEXP.PI_RECTIFICA ELSE FACTEXP.PI_CODIGO END)) END) AS PATENTE_FOLIO,
(SELECT CP_CLAVE FROM  CLAVEPED WHERE CP_CODIGO=(CASE WHEN FACTEXP.PI_RECTIFICA>-1 THEN (SELECT CP_CODIGO FROM PEDIMP WHERE PI_CODIGO=FACTEXP.PI_RECTIFICA) ELSE 
(SELECT CP_CODIGO FROM PEDIMP WHERE PI_CODIGO=FACTEXP.PI_CODIGO) END)) AS CP_CLAVE,
(CASE WHEN PI_RECTIFICA>-1 THEN PI_RECTIFICA ELSE PI_CODIGO END) AS PI_CODIGO, FE_CODIGO
FROM         FACTEXP








































GO
