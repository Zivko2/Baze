SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO






CREATE VIEW dbo.VDATOSPEDEXPPAGOUSA1
with encryption as
SELECT     dbo.PEDIMPDET.PIB_INDICEB, dbo.FACTEXPDET.FED_INDICED, dbo.PEDIMPDET.AR_EXPFO, 
                      SUM(dbo.FACTEXPDET.FED_CANT * (dbo.FACTEXPDET.FED_GRA_MO + dbo.FACTEXPDET.FED_GRA_EMP + dbo.FACTEXPDET.FED_GRA_ADD + dbo.FACTEXPDET.FED_GRA_GI_MX
                       + dbo.FACTEXPDET.FED_GRA_MP + dbo.FACTEXPDET.FED_NG_MP + dbo.FACTEXPDET.FED_NG_ADD - dbo.FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSA,
                      SUM(dbo.PEDIMP.PI_TIP_CAM *dbo.FACTEXPDET.FED_CANT * (dbo.FACTEXPDET.FED_GRA_MO + dbo.FACTEXPDET.FED_GRA_EMP + dbo.FACTEXPDET.FED_GRA_ADD + dbo.FACTEXPDET.FED_GRA_GI_MX
                       + dbo.FACTEXPDET.FED_GRA_MP + dbo.FACTEXPDET.FED_NG_MP + dbo.FACTEXPDET.FED_NG_ADD - dbo.FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSAMN, 
		dbo.PEDIMPDETB.PIB_SECUENCIA, dbo.PEDIMPDET.PI_CODIGO, 
                      dbo.PEDIMPDETB.PIB_DESTNAFTA, dbo.FACTEXPDET.FED_RATEIMPFO
FROM         dbo.FACTEXPDET INNER JOIN
                      dbo.PEDIMPDET ON dbo.FACTEXPDET.PID_INDICEDLIGA = dbo.PEDIMPDET.PID_INDICED LEFT OUTER JOIN
                      dbo.PEDIMP ON dbo.PEDIMPDET.PI_CODIGO = dbo.PEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.PEDIMPDETB ON dbo.PEDIMPDET.PIB_INDICEB = dbo.PEDIMPDETB.PIB_INDICEB
WHERE dbo.PEDIMP.PI_ESTATUS <>'R'
GROUP BY dbo.PEDIMPDET.PIB_INDICEB, dbo.FACTEXPDET.FED_INDICED, dbo.PEDIMPDET.AR_EXPFO, dbo.PEDIMPDETB.PIB_SECUENCIA, 
                      dbo.PEDIMPDET.PI_CODIGO, dbo.PEDIMPDETB.PIB_DESTNAFTA, dbo.FACTEXPDET.FED_RATEIMPFO
UNION
SELECT     dbo.PEDIMPDET.PIB_INDICEB, dbo.FACTEXPDET.FED_INDICED, dbo.PEDIMPDET.AR_EXPFO, 
                      SUM(dbo.FACTEXPDET.FED_CANT * (dbo.FACTEXPDET.FED_GRA_MO + dbo.FACTEXPDET.FED_GRA_EMP + dbo.FACTEXPDET.FED_GRA_ADD + dbo.FACTEXPDET.FED_GRA_GI_MX
                       + dbo.FACTEXPDET.FED_GRA_MP + dbo.FACTEXPDET.FED_NG_MP + dbo.FACTEXPDET.FED_NG_ADD - dbo.FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSA, 
                      SUM(dbo.PEDIMP.PI_TIP_CAM *dbo.FACTEXPDET.FED_CANT * (dbo.FACTEXPDET.FED_GRA_MO + dbo.FACTEXPDET.FED_GRA_EMP + dbo.FACTEXPDET.FED_GRA_ADD + dbo.FACTEXPDET.FED_GRA_GI_MX
                       + dbo.FACTEXPDET.FED_GRA_MP + dbo.FACTEXPDET.FED_NG_MP + dbo.FACTEXPDET.FED_NG_ADD - dbo.FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSAMN, 
		dbo.PEDIMPDETB.PIB_SECUENCIA, dbo.PEDIMPDET.PI_CODIGO, 
                      dbo.PEDIMPDETB.PIB_DESTNAFTA, dbo.FACTEXPDET.FED_RATEIMPFO
FROM         dbo.FACTEXPDET INNER JOIN
                      dbo.PEDIMPDET ON dbo.FACTEXPDET.PID_INDICEDLIGAR1 = dbo.PEDIMPDET.PID_INDICED LEFT OUTER JOIN
                      dbo.PEDIMP ON dbo.PEDIMPDET.PI_CODIGO = dbo.PEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.PEDIMPDETB ON dbo.PEDIMPDET.PIB_INDICEB = dbo.PEDIMPDETB.PIB_INDICEB
GROUP BY dbo.PEDIMPDET.PIB_INDICEB, dbo.FACTEXPDET.FED_INDICED, dbo.PEDIMPDET.AR_EXPFO, dbo.PEDIMPDETB.PIB_SECUENCIA, 
                      dbo.PEDIMPDET.PI_CODIGO, dbo.PEDIMPDETB.PIB_DESTNAFTA, dbo.FACTEXPDET.FED_RATEIMPFO










GO
