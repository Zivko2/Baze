SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO






















CREATE VIEW dbo.VREPANUALPEDIMENTOS
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = '3' OR dbo.TIPO.TI_CATEGM = '4' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR='S') and 
	(dbo.CONFIGURACLAVEPED.CCP_TIPO IN ('IV', 'VT', 'IM', 'IE') AND dbo.VPEDIMP.PI_ESTATUS <> 'R') 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = '3' OR dbo.TIPO.TI_CATEGM = '4' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR='S') and 
                    dbo.CONFIGURACLAVEPED.CCP_TIPO = 'RE' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN ('IV', 'VT', 'IM', 'IE'))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR='S') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN ('IV', 'VT', 'IT', 'IE') AND dbo.VPEDIMP.PI_ESTATUS <> 'R')  
 AND (dbo.TIPO.TI_CATEGM = '1' OR dbo.TIPO.TI_CATEGM = '2')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR='S') and dbo.CONFIGURACLAVEPED.CCP_TIPO = 'RE' AND 
		dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN ('IV', 'VT', 'IT', 'IE')) AND (dbo.TIPO.TI_CATEGM = '1' OR dbo.TIPO.TI_CATEGM = '2')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.PEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR='S') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = 'CN') AND (dbo.PEDIMP.PI_MOVIMIENTO = 'S') 
		AND (dbo.TIPO.TI_CATEGM = '3' OR dbo.TIPO.TI_CATEGM = '4' OR dbo.TIPO.TI_CATEGM = '1' OR dbo.TIPO.TI_CATEGM = '2' ) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO = 'S') AND (dbo.PEDIMP.PI_ESTATUS <> 'O') and (dbo.PEDIMPDET.PID_IMPRIMIR='S')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO





















GO
