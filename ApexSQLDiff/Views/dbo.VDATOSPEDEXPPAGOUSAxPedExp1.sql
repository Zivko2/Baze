SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW dbo.VDATOSPEDEXPPAGOUSAxPedExp1
with encryption as
SELECT     PEDIMPDET.PIB_INDICEB, FACTEXPDET.FED_INDICED, PEDIMPDET.AR_EXPFO, 
                      SUM(FACTEXPDET.FED_CANT * (FACTEXPDET.FED_GRA_MO + FACTEXPDET.FED_GRA_EMP + FACTEXPDET.FED_GRA_ADD + FACTEXPDET.FED_GRA_GI_MX
                       + FACTEXPDET.FED_GRA_MP + FACTEXPDET.FED_NG_MP + FACTEXPDET.FED_NG_ADD - FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSA,
                      SUM(PEDIMP.PI_TIP_CAM *FACTEXPDET.FED_CANT * (FACTEXPDET.FED_GRA_MO + FACTEXPDET.FED_GRA_EMP + FACTEXPDET.FED_GRA_ADD + FACTEXPDET.FED_GRA_GI_MX
                       + FACTEXPDET.FED_GRA_MP + FACTEXPDET.FED_NG_MP + FACTEXPDET.FED_NG_ADD - FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSAMN, 
		PEDIMPDETB.PIB_SECUENCIA, PEDIMPDET.PI_CODIGO, 
                      PEDIMPDETB.PIB_DESTNAFTA, FACTEXPDET.FED_RATEIMPFO, FACTEXPDET.MA_CODIGO AS MA_CODIGOFED
FROM         FACTEXPDET INNER JOIN
                      PEDIMPDET ON FACTEXPDET.PID_INDICEDLIGA = PEDIMPDET.PID_INDICED LEFT OUTER JOIN
                      PEDIMP ON PEDIMPDET.PI_CODIGO = PEDIMP.PI_CODIGO LEFT OUTER JOIN
                      PEDIMPDETB ON PEDIMPDET.PIB_INDICEB = PEDIMPDETB.PIB_INDICEB
WHERE PEDIMP.PI_ESTATUS <>'R'
AND PEDIMPDET.PI_CODIGO=07503 
GROUP BY PEDIMPDET.PIB_INDICEB, FACTEXPDET.FED_INDICED, PEDIMPDET.AR_EXPFO, PEDIMPDETB.PIB_SECUENCIA, 
                      PEDIMPDET.PI_CODIGO, PEDIMPDETB.PIB_DESTNAFTA, FACTEXPDET.FED_RATEIMPFO, FACTEXPDET.MA_CODIGO
UNION
SELECT     PEDIMPDET.PIB_INDICEB, FACTEXPDET.FED_INDICED, PEDIMPDET.AR_EXPFO, 
                      SUM(FACTEXPDET.FED_CANT * (FACTEXPDET.FED_GRA_MO + FACTEXPDET.FED_GRA_EMP + FACTEXPDET.FED_GRA_ADD + FACTEXPDET.FED_GRA_GI_MX
                       + FACTEXPDET.FED_GRA_MP + FACTEXPDET.FED_NG_MP + FACTEXPDET.FED_NG_ADD - FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSA, 
                      SUM(PEDIMP.PI_TIP_CAM *FACTEXPDET.FED_CANT * (FACTEXPDET.FED_GRA_MO + FACTEXPDET.FED_GRA_EMP + FACTEXPDET.FED_GRA_ADD + FACTEXPDET.FED_GRA_GI_MX
                       + FACTEXPDET.FED_GRA_MP + FACTEXPDET.FED_NG_MP + FACTEXPDET.FED_NG_ADD - FACTEXPDET.FED_NG_USA)) AS TOTALVALORUSAMN, 
		PEDIMPDETB.PIB_SECUENCIA, PEDIMPDET.PI_CODIGO, 
                      PEDIMPDETB.PIB_DESTNAFTA, FACTEXPDET.FED_RATEIMPFO, FACTEXPDET.MA_CODIGO AS MA_CODIGOFED
FROM         FACTEXPDET INNER JOIN
                      PEDIMPDET ON FACTEXPDET.PID_INDICEDLIGAR1 = PEDIMPDET.PID_INDICED LEFT OUTER JOIN
                      PEDIMP ON PEDIMPDET.PI_CODIGO = PEDIMP.PI_CODIGO LEFT OUTER JOIN
                      PEDIMPDETB ON PEDIMPDET.PIB_INDICEB = PEDIMPDETB.PIB_INDICEB
AND PEDIMPDET.PI_CODIGO=07503 
GROUP BY PEDIMPDET.PIB_INDICEB, FACTEXPDET.FED_INDICED, PEDIMPDET.AR_EXPFO, PEDIMPDETB.PIB_SECUENCIA, 
                      PEDIMPDET.PI_CODIGO, PEDIMPDETB.PIB_DESTNAFTA, FACTEXPDET.FED_RATEIMPFO, FACTEXPDET.MA_CODIGO 
GO
