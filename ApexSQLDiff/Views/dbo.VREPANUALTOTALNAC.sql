SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO






































CREATE VIEW dbo.VREPANUALTOTALNAC
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.FACTEXPDET.MA_GENERICO, MAX(dbo.FACTEXPDET.FED_NOMBRE) AS FED_NOMBRE, 
                      dbo.FACTEXPDET.SE_CODIGO, SUM(dbo.FACTEXPDET.FED_CANT * dbo.FACTEXPDET.EQ_EXPMX) AS FED_CANT, 
                      SUM(dbo.FACTEXPDET.FED_COS_TOT * dbo.FACTEXP.FE_TIPOCAMBIO * dbo.FACTEXPDET.EQ_EXPMX) AS VALOR,
                      SUM(dbo.FACTEXPDET.FED_COS_TOT * dbo.FACTEXP.FE_TIPOCAMBIO) AS VALOR2, FACTEXPDET.ME_AREXPMX, AR_EXPMX
FROM         dbo.DECANUALNVA INNER JOIN
                      dbo.FACTEXP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.FACTEXP.FE_FECHA AND 
                      dbo.DECANUALNVA.DAN_FINAL >= dbo.FACTEXP.FE_FECHA LEFT OUTER JOIN
                      dbo.CONFIGURATFACT ON dbo.FACTEXP.TF_CODIGO = dbo.CONFIGURATFACT.TF_CODIGO LEFT OUTER JOIN
                      dbo.FACTEXPDET ON dbo.FACTEXP.FE_CODIGO = dbo.FACTEXPDET.FE_CODIGO
WHERE     (dbo.CONFIGURATFACT.CFF_TIPO = 'MN') AND (dbo.FACTEXPDET.SE_CODIGO IS NOT NULL) AND (dbo.FACTEXPDET.SE_CODIGO <> 0)
GROUP BY dbo.FACTEXPDET.MA_GENERICO, dbo.FACTEXPDET.TI_CODIGO, dbo.FACTEXPDET.SE_CODIGO, dbo.DECANUALNVA.DAN_CODIGO, FACTEXPDET.ME_AREXPMX, AR_EXPMX
HAVING      (dbo.FACTEXPDET.TI_CODIGO IN
                          (SELECT     TI_CODIGO
                            FROM          CONFIGURATIPO
                            WHERE      CFT_TIPO IN ('P', 'S')))







































GO
