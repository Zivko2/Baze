SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




























CREATE PROCEDURE dbo.SP_REPANUALIMPDEFACTFIJ ( @DANCODIGO INT)   as

SET NOCOUNT ON 

DECLARE @IMPDEFINITIVAS decimal(38,6), @IMPDEFINITIVASdlls decimal(38,6)


/*if exists (select * FROM VREPANUALIMPDEFACTFIJ WHERE DAN_CODIGO = @DANCODIGO)
begin
*/

SELECT     @IMPDEFINITIVAS=SUM(VALOR), @IMPDEFINITIVASdlls=SUM(DLLS)
FROM         VREPANUALIMPDEFACTFIJ
WHERE     DAN_CODIGO = @DANCODIGO
GROUP BY DAN_CODIGO


	UPDATE DECANUALNVA
	SET DAN_IMPDEFINITIVASACTFIJ = isnull(floor(round(@IMPDEFINITIVAS, 0)/1000),0), DAN_IMPDEFINITIVASACTFIJUSD= isnull(floor(round(@IMPDEFINITIVASdlls, 0)/1000),0)
	WHERE DECANUALNVA.DAN_CODIGO = @DANCODIGO


/*end
else
begin
	UPDATE DECANUALNVA
	SET DAN_IMPDEFINITIVASACTFIJ=0, DAN_IMPDEFINITIVASACTFIJUSD=0
	WHERE DECANUALNVA.DAN_CODIGO = @DANCODIGO

end
*/



























GO
