SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO



























CREATE PROCEDURE [dbo].[SP_GENERAVISTASDECANUAL]   as



if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALDIRCAT1]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALDIRCAT1]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALDIRCAT2]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALDIRCAT2]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALDIRCAT3Y4]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALDIRCAT3Y4]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALDIRINDCAT1Pidindiced]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALDIRINDCAT1Pidindiced]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALDIRINDCAT3Y4Pidindiced]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALDIRINDCAT3Y4Pidindiced]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALIMPUESTOENT]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALIMPUESTOENT]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALIMPUESTOXPAGAR]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALIMPUESTOXPAGAR]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALINDCAT1]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALINDCAT1]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALINDCAT2]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALINDCAT2]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALINDCAT3Y4]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALINDCAT3Y4]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALTOTALEXP]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALTOTALEXP]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALTOTALEXP1]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALTOTALEXP1]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VDECANUALTOTALIMP]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VDECANUALTOTALIMP]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALIMPDEFACTFIJ]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALIMPDEFACTFIJ]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALIMPDEFMAT]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALIMPDEFMAT]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALIMPTEMPACTFIJ]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALIMPTEMPACTFIJ]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALIMPTEMPACTFIJPidindiced]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALIMPTEMPACTFIJPidindiced]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALIMPTEMPMAT]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALIMPTEMPMAT]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALIMPTEMPMATPidindiced]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALIMPTEMPMATPidindiced]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALMDONACACTFIJ]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALMDONACACTFIJ]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALMDONACMAT]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALMDONACMAT]


if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[VREPANUALPEDIMENTOS]') and OBJECTPROPERTY(id, N'IsView') = 1)
drop view [dbo].[VREPANUALPEDIMENTOS]



IF (select CF_FECHAENTDECANUAL from configuracion)='S' 
begin
exec('CREATE VIEW dbo.VDECANUALDIRCAT1
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' )  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')

exec('CREATE VIEW dbo.VDECANUALDIRCAT2
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''2'' )  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')



exec('CREATE VIEW dbo.VDECANUALDIRCAT3Y4
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')


exec('CREATE VIEW dbo.VDECANUALDIRINDCAT1Pidindiced
with encryption as
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' )  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''1'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'') ')



exec('CREATE VIEW dbo.VDECANUALDIRINDCAT3Y4Pidindiced
with encryption as
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  

UNION
SELECT       dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'') ')





exec('CREATE VIEW dbo.VDECANUALIMPUESTOENT
with encryption as
SELECT     SUM(dbo.VPEDIMPCONTRIBUCION.PIT_CONTRIBTOTMN) AS PIT_CONTRIBTOTMN, dbo.DECANUALNVA.DAN_CODIGO,  dbo.VPEDIMP.PI_FEC_ENT as PI_FEC_PAG, 
                      dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMPCONTRIBUCION INNER JOIN
                      dbo.VPEDIMP ON dbo.VPEDIMPCONTRIBUCION.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO INNER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL
WHERE      (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
                   and (dbo.VPEDIMPCONTRIBUCION.CON_CODIGO  in(select CON_CODIGO  from contribucion where con_clave=''6'')) 
and (dbo.VPEDIMPCONTRIBUCION.PG_CODIGO  in (SELECT PG_CODIGO  FROM TPAGO WHERE PG_CLAVEM3=''0''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     SUM(dbo.VPEDIMPCONTRIBUCION.PIT_CONTRIBTOTMN) AS PIT_CONTRIBTOTMN, dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_FEC_ENT as PI_FEC_PAG, 
                      dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMPCONTRIBUCION INNER JOIN
                      dbo.VPEDIMP ON dbo.VPEDIMPCONTRIBUCION.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO INNER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL
WHERE       (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT''))  and (dbo.VPEDIMPCONTRIBUCION.CON_CODIGO  in(select CON_CODIGO  from contribucion where con_clave=''6'')) 
and (dbo.VPEDIMPCONTRIBUCION.PG_CODIGO  in (SELECT PG_CODIGO  FROM TPAGO WHERE PG_CLAVEM3=''0''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO')




exec('CREATE VIEW dbo.VDECANUALIMPUESTOXPAGAR
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA
		 IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED WHERE CCP_TIPO = ''IT''))
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IV'' and dbo.MAESTRO.MA_SERVICIO=''S'')
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA
		 IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED WHERE CCP_TIPO = ''IV'') AND  dbo.MAESTRO.MA_SERVICIO=''S'' 
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO')

exec('CREATE VIEW dbo.VDECANUALINDCAT1
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''1'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')


	
exec('CREATE VIEW dbo.VDECANUALINDCAT2
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')




exec('CREATE VIEW dbo.VDECANUALINDCAT3Y4
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')








exec('CREATE VIEW dbo.VDECANUALTOTALEXP
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM(dbo.PEDIMPDET.PID_COS_UNIVA * dbo.PEDIMPDET.PID_CANT * dbo.PEDIMP.PI_TIP_CAM) AS VALOR, 
                      dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') AND (dbo.PEDIMP.PI_ESTATUS <> ''O'') and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_TOTALEXP, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMPDET.PID_COS_UNIVA * dbo.PEDIMPDET.PID_CANT, 
                      dbo.PEDIMP.PI_TIP_CAM, dbo.PEDIMP.PI_CODIGO')


exec('CREATE VIEW dbo.VDECANUALTOTALEXP1
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM(dbo.PEDIMPDET.PID_COS_UNI * dbo.PEDIMPDET.PID_CANT * dbo.PEDIMP.PI_TIP_CAM) AS VALOR, 
                      dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') AND (dbo.PEDIMP.PI_ESTATUS <> ''O'') and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_TOTALEXP, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMPDET.PID_COS_UNI * dbo.PEDIMPDET.PID_CANT, 
                      dbo.PEDIMP.PI_TIP_CAM, dbo.PEDIMP.PI_CODIGO')



exec('CREATE VIEW dbo.VDECANUALTOTALIMP
with encryption as
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.PEDIMP.PI_TIP_CAM) AS VALOR, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO =''E'') AND (dbo.PEDIMP.PI_ESTATUS <> ''R'') AND (dbo.PEDIMPDET.TI_CODIGO NOT IN
                          (SELECT     TI_CODIGO
                            FROM          dbo.CONFIGURATIPO
                            WHERE      CFT_TIPO IN (''C'', ''H'', ''Q'', ''X''))) and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_TOTALEXP, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO')



exec('CREATE VIEW dbo.VREPANUALIMPDEFACTFIJ
with encryption as
--importacion definitivas de activo fijo que no estan rectificadas
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IE'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
UNION
--r1 que son definitivas de activo fijo
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE''  AND dbo.VPEDIMP.CP_RECTIFICA IN
                          (SELECT     CP_CODIGO FROM CONFIGURACLAVEPED  WHERE      CCP_TIPO = ''IE'') 
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX')


exec('CREATE VIEW dbo.VREPANUALIMPDEFMAT
with encryption as
-- importacion definitiva de materia prima
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IE'') AND (dbo.VPEDIMP.PI_ESTATUS <> ''R'')
AND  (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
UNION
-- r1 de importacion definitiva de materia prima
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN
                          (SELECT     CP_CODIGO FROM CONFIGURACLAVEPED WHERE CCP_TIPO = ''IE'') 
AND  (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX')

exec('CREATE VIEW dbo.VREPANUALIMPTEMPACTFIJ
with encryption as
-- h3 que no estan recificados
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
UNION
-- rectificaciones que son h3
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS), dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
UNION
-- virtuales que no estas rectificados
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS), dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
	(dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX                    
UNION
--r1 virtuales
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS), dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
                    dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX')

exec('CREATE VIEW dbo.VREPANUALIMPTEMPACTFIJPidindiced
with encryption as
-- h3 que no estan recificados
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )  
UNION
-- rectificaciones que son h3
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
UNION
-- virtuales que no estas rectificados
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
	(dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
UNION
--r1 virtuales
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
                    dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT''))')



exec('CREATE VIEW dbo.VREPANUALIMPTEMPMAT
with encryption as
SELECT    SUM( ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM                  
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS),
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''V''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
 AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''V''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND 
		dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM')




exec('CREATE VIEW dbo.VREPANUALIMPTEMPMATPidindiced
with encryption as
SELECT    dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED                 
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
 AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND 
		dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')')


exec('CREATE VIEW dbo.VREPANUALMDONACACTFIJ
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO, ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) * dbo.PEDIMP.PI_TIP_CAM AS VALOR, 
                      ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) AS PID_CTOT_DLS, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.PEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''CN'') AND (dbo.PEDIMP.PI_MOVIMIENTO = ''E'') 
		AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')')



exec('CREATE VIEW dbo.VREPANUALMDONACMAT
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO, ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) * dbo.PEDIMP.PI_TIP_CAM AS VALOR, 
                      ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) AS PID_CTOT_DLS, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.PEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''CN'') AND (dbo.PEDIMP.PI_MOVIMIENTO = ''E'') 
AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' )')



exec('CREATE VIEW dbo.VREPANUALPEDIMENTOS
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
	(dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'', ''IM'', ''IE'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
                    dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'', ''IM'', ''IE''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'', ''IT'', ''IE'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
 AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_ENT AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_ENT ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND 
		dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'', ''IT'', ''IE'')) AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.PEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''CN'') AND (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') 
		AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' OR dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' ) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_ENT >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_ENT <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') AND (dbo.PEDIMP.PI_ESTATUS <> ''O'') and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO')


end
else/*============================================== POR FECHA DE PAGO ===============================================*/
begin
exec('CREATE VIEW dbo.VDECANUALDIRCAT1
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' )  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')


exec('CREATE VIEW dbo.VDECANUALDIRCAT2
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''2'' )  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')



exec('CREATE VIEW dbo.VDECANUALDIRCAT3Y4
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY  dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')


exec('CREATE VIEW dbo.VDECANUALDIRINDCAT1Pidindiced
with encryption as
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' )  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''1'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'') ')



exec('CREATE VIEW dbo.VDECANUALDIRINDCAT3Y4Pidindiced
with encryption as
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  

UNION
SELECT       dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'') ')



exec('CREATE VIEW dbo.VDECANUALIMPUESTOENT
with encryption as
SELECT     SUM(dbo.VPEDIMPCONTRIBUCION.PIT_CONTRIBTOTMN) AS PIT_CONTRIBTOTMN, dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_FEC_PAG, 
                      dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMPCONTRIBUCION INNER JOIN
                      dbo.VPEDIMP ON dbo.VPEDIMPCONTRIBUCION.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO INNER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL
WHERE      (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
                   and (dbo.VPEDIMPCONTRIBUCION.CON_CODIGO  in(select CON_CODIGO  from contribucion where con_clave=''6'')) 
and (dbo.VPEDIMPCONTRIBUCION.PG_CODIGO  in (SELECT PG_CODIGO  FROM TPAGO WHERE PG_CLAVEM3=''0''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     SUM(dbo.VPEDIMPCONTRIBUCION.PIT_CONTRIBTOTMN) AS PIT_CONTRIBTOTMN, dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_FEC_PAG, 
                      dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMPCONTRIBUCION INNER JOIN
                      dbo.VPEDIMP ON dbo.VPEDIMPCONTRIBUCION.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO INNER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL
WHERE       (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT''))  and (dbo.VPEDIMPCONTRIBUCION.CON_CODIGO  in(select CON_CODIGO  from contribucion where con_clave=''6'')) 
and (dbo.VPEDIMPCONTRIBUCION.PG_CODIGO  in (SELECT PG_CODIGO  FROM TPAGO WHERE PG_CLAVEM3=''0''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO')




exec('CREATE VIEW dbo.VDECANUALIMPUESTOXPAGAR
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG as PI_FEC_ENT, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA
		 IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED WHERE CCP_TIPO = ''IT''))
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IV'' and dbo.MAESTRO.MA_SERVICIO=''S'')
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM((dbo.PEDIMPDET.PID_CAN_GEN * dbo.PEDIMPDET.PID_COS_UNIGEN * dbo.VPEDIMP.PI_TIP_CAM) 
                      * (dbo.PEDIMPDET.PID_POR_DEF / 100)) AS IMPUESTOXPAGAR, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.VPEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.VPEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.VPEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL LEFT OUTER JOIN
                      dbo.PEDIMPDET ON dbo.VPEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO LEFT OUTER JOIN
                      dbo.MAESTRO ON dbo.PEDIMPDET.MA_CODIGO = dbo.MAESTRO.MA_CODIGO
WHERE   (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') AND dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA
		 IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED WHERE CCP_TIPO = ''IV'') AND  dbo.MAESTRO.MA_SERVICIO=''S'' 
		AND (dbo.PEDIMPDET.PID_PAGACONTRIB =''S'') AND (dbo.PEDIMPDET.PID_POR_DEF > 0) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.[PATENTE-FOLIO], dbo.VPEDIMP.PI_FEC_PAG, dbo.VPEDIMP.PI_CODIGO')

exec('CREATE VIEW dbo.VDECANUALINDCAT1
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''1'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')


	
exec('CREATE VIEW dbo.VDECANUALINDCAT2
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')




exec('CREATE VIEW dbo.VDECANUALINDCAT3Y4
with encryption as
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'',  ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'',  ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')  
GROUP BY                       dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE,  dbo.TIPO.TI_CATEGM')



exec('CREATE VIEW dbo.VDECANUALTOTALEXP
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM(dbo.PEDIMPDET.PID_COS_UNIVA * dbo.PEDIMPDET.PID_CANT * dbo.PEDIMP.PI_TIP_CAM) AS VALOR, 
                      dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') AND (dbo.PEDIMP.PI_ESTATUS <> ''O'') and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_TOTALEXP, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMPDET.PID_COS_UNIVA * dbo.PEDIMPDET.PID_CANT, 
                      dbo.PEDIMP.PI_TIP_CAM, dbo.PEDIMP.PI_CODIGO')


exec('CREATE VIEW dbo.VDECANUALTOTALEXP1
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, SUM(dbo.PEDIMPDET.PID_COS_UNI * dbo.PEDIMPDET.PID_CANT * dbo.PEDIMP.PI_TIP_CAM) AS VALOR, 
                      dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') AND (dbo.PEDIMP.PI_ESTATUS <> ''O'') and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_TOTALEXP, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMPDET.PID_COS_UNI * dbo.PEDIMPDET.PID_CANT, 
                      dbo.PEDIMP.PI_TIP_CAM, dbo.PEDIMP.PI_CODIGO')



exec('CREATE VIEW dbo.VDECANUALTOTALIMP
with encryption as
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.PEDIMP.PI_TIP_CAM) AS VALOR, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO =''E'') AND (dbo.PEDIMP.PI_ESTATUS <> ''R'') AND (dbo.PEDIMPDET.TI_CODIGO NOT IN
                          (SELECT     TI_CODIGO
                            FROM          dbo.CONFIGURATIPO
                            WHERE      CFT_TIPO IN (''C'', ''H'', ''Q'', ''X''))) and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_TOTALEXP, dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO')



exec('CREATE VIEW dbo.VREPANUALIMPDEFACTFIJ
with encryption as
--importacion definitivas de activo fijo que no estan rectificadas
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IE'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
UNION
--r1 que son definitivas de activo fijo
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE''  AND dbo.VPEDIMP.CP_RECTIFICA IN
                          (SELECT     CP_CODIGO FROM CONFIGURACLAVEPED  WHERE      CCP_TIPO = ''IE'') 
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX')



exec('CREATE VIEW dbo.VREPANUALIMPDEFMAT
with encryption as
-- importacion definitiva de materia prima
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IE'') AND (dbo.VPEDIMP.PI_ESTATUS <> ''R'')
AND  (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
UNION
-- r1 de importacion definitiva de materia prima
SELECT     SUM(dbo.PEDIMPDET.PID_CTOT_DLS * dbo.VPEDIMP.PI_TIP_CAM) AS VALOR, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS DLLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN
                          (SELECT     CP_CODIGO FROM CONFIGURACLAVEPED WHERE CCP_TIPO = ''IE'') 
AND  (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX')

exec('CREATE VIEW dbo.VREPANUALIMPTEMPACTFIJ
with encryption as
-- h3 que no estan recificados
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
UNION
-- rectificaciones que son h3
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS), dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
UNION
-- virtuales que no estas rectificados
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS), dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
	(dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX                    
UNION
--r1 virtuales
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, SUM(dbo.VPEDIMP.PI_TIP_CAM * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, 
                      SUM(dbo.PEDIMPDET.PID_CTOT_DLS), dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
                    dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO,  dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, dbo.PEDIMPDET.AR_IMPMX')

exec('CREATE VIEW dbo.VREPANUALIMPTEMPACTFIJPidindiced
with encryption as
-- h3 que no estan recificados
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IM'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )  
UNION
-- rectificaciones que son h3
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IM'') AND  (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' )   
UNION
-- virtuales que no estas rectificados
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
	(dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
UNION
--r1 virtuales
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
                    dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT''))')



exec('CREATE VIEW dbo.VREPANUALIMPTEMPMAT
with encryption as
SELECT    SUM( ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS) AS PID_CTOT_DLS, 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''T''  AS TIPO, dbo.TIPO.TI_CATEGM                  
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS),
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''V''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
 AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM
UNION
SELECT     SUM(ISNULL(dbo.VPEDIMP.PI_TIP_CAM, 1) * dbo.PEDIMPDET.PID_CTOT_DLS) AS valor, SUM(dbo.PEDIMPDET.PID_CTOT_DLS), 
                      dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, ''V''  AS TIPO, dbo.TIPO.TI_CATEGM
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND 
		dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO, dbo.PEDIMPDET.AR_IMPMX, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.PID_NOMBRE, dbo.TIPO.TI_CATEGM')




exec('CREATE VIEW dbo.VREPANUALIMPTEMPMATPidindiced
with encryption as
SELECT    dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''IT'' AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED                 
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO = ''IT'') AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
 AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
UNION
SELECT     dbo.PEDIMPDET.PID_INDICED
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND 
		dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'')) AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')')


exec('CREATE VIEW dbo.VREPANUALMDONACACTFIJ
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO, ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) * dbo.PEDIMP.PI_TIP_CAM AS VALOR, 
                      ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) AS PID_CTOT_DLS, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.PEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''CN'') AND (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') 
		AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'')')



exec('CREATE VIEW dbo.VREPANUALMDONACMAT
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO, ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) * dbo.PEDIMP.PI_TIP_CAM AS VALOR, 
                      ISNULL(dbo.PEDIMPDET.PID_CTOT_DLS, 0) AS PID_CTOT_DLS, dbo.PEDIMPDET.PID_NOMBRE, dbo.PEDIMPDET.MA_GENERICO, 
                      dbo.PEDIMPDET.AR_IMPMX
FROM         dbo.PEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.PEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''CN'') AND (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') 
AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' )')



exec('CREATE VIEW dbo.VREPANUALPEDIMENTOS
with encryption as
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
	(dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'', ''IM'', ''IE'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'') 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' ) AND (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and 
                    dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'', ''IM'', ''IE''))
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and (dbo.CONFIGURACLAVEPED.CCP_TIPO IN (''IV'', ''VT'', ''IT'', ''IE'') AND dbo.VPEDIMP.PI_ESTATUS <> ''R'')  
 AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')  
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
FROM         dbo.PEDIMPDET LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO RIGHT OUTER JOIN
                      dbo.DECANUALNVA INNER JOIN
                      dbo.VPEDIMP ON dbo.DECANUALNVA.DAN_INICIO <= dbo.VPEDIMP.PI_FEC_PAG AND dbo.DECANUALNVA.DAN_FINAL >= dbo.VPEDIMP.PI_FEC_PAG ON
                       dbo.PEDIMPDET.PI_CODIGO = dbo.VPEDIMP.PI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.VPEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE     (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and dbo.CONFIGURACLAVEPED.CCP_TIPO = ''RE'' AND 
		dbo.VPEDIMP.CP_RECTIFICA IN (SELECT CP_CODIGO FROM CONFIGURACLAVEPED
                            WHERE      CCP_TIPO IN (''IV'', ''VT'', ''IT'', ''IE'')) AND (dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.VPEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.CONFIGURATIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.CONFIGURATIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.TIPO ON dbo.PEDIMPDET.TI_CODIGO = dbo.TIPO.TI_CODIGO LEFT OUTER JOIN
                      dbo.CONFIGURACLAVEPED ON dbo.PEDIMP.CP_CODIGO = dbo.CONFIGURACLAVEPED.CP_CODIGO
WHERE    (dbo.PEDIMPDET.PID_IMPRIMIR=''S'') and  (dbo.CONFIGURACLAVEPED.CCP_TIPO = ''CN'') AND (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') 
		AND (dbo.TIPO.TI_CATEGM = ''3'' OR dbo.TIPO.TI_CATEGM = ''4'' OR dbo.TIPO.TI_CATEGM = ''1'' OR dbo.TIPO.TI_CATEGM = ''2'' ) 
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
UNION
SELECT     dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO
FROM         dbo.PEDIMP INNER JOIN
                      dbo.PEDIMPDET ON dbo.PEDIMP.PI_CODIGO = dbo.PEDIMPDET.PI_CODIGO INNER JOIN
                      dbo.DECANUALNVA ON dbo.PEDIMP.PI_FEC_PAG >= dbo.DECANUALNVA.DAN_INICIO AND 
                      dbo.PEDIMP.PI_FEC_PAG <= dbo.DECANUALNVA.DAN_FINAL
WHERE     (dbo.PEDIMP.PI_MOVIMIENTO = ''S'') AND (dbo.PEDIMP.PI_ESTATUS <> ''O'') and (dbo.PEDIMPDET.PID_IMPRIMIR=''S'')
GROUP BY dbo.DECANUALNVA.DAN_CODIGO, dbo.PEDIMP.PI_CODIGO')


end

























GO
