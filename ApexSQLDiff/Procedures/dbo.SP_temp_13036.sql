SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO




























CREATE PROCEDURE [dbo].[SP_temp_13036]   as


		UPDATE TRANSMISION 
	SET     TRANSMISION.TRM_FOLIOPED= PEDIMP.PI_FOLIO
	FROM         PEDIMP RIGHT OUTER JOIN
	                      TRANSMISIONREL ON PEDIMP.PI_CODIGO = TRANSMISIONREL.ET_CODIGO RIGHT OUTER JOIN
	                      TRANSMISION ON TRANSMISIONREL.TRM_CODIGO = TRANSMISION.TRM_CODIGO
	WHERE     (TRANSMISION.TRM_PREVIOCONS = 'B' OR
	                      TRANSMISION.TRM_PREVIOCONS = 'F') AND (PEDIMP.PI_FOLIO IS NOT NULL)
	
	UPDATE TRANSMISION 
	SET     TRANSMISION.TRM_FOLIOPED= FACTCONS.FC_FOLIO
	FROM         TRANSMISION INNER JOIN
	                      TRANSMISIONREL ON TRANSMISION.TRM_CODIGO = TRANSMISIONREL.TRM_CODIGO INNER JOIN
	                      FACTCONS ON TRANSMISIONREL.ET_CODIGO = FACTCONS.FC_CODIGO
	WHERE     (TRANSMISION.TRM_PREVIOCONS = 'P')


	--actualiza el fc_codigo de la tabla factcons que se le quito el identity
	EXEC SP_ACTUALIZACONSECUTIVO


	UPDATE FACTIMPDET
	SET PID_INDICEDLIGA =-1
	FROM         FACTIMP INNER JOIN
	                      FACTIMPDET ON FACTIMP.FI_CODIGO = FACTIMPDET.FI_CODIGO 
	WHERE FACTIMP.PI_CODIGO = -1 AND PID_INDICEDLIGA <>-1


	UPDATE FACTIMPDET
	SET PID_INDICEDLIGAR1 =-1
	FROM         FACTIMP INNER JOIN
	                      FACTIMPDET ON FACTIMP.FI_CODIGO = FACTIMPDET.FI_CODIGO 
	WHERE FACTIMP.PI_RECTIFICA = -1 AND PID_INDICEDLIGAR1 <>-1



	UPDATE FACTEXPDET
	SET PID_INDICEDLIGA =-1
	FROM         FACTEXP INNER JOIN
	                      FACTEXPDET ON FACTEXP.FE_CODIGO = FACTEXPDET.FE_CODIGO 
	WHERE FACTEXP.PI_CODIGO = -1 AND PID_INDICEDLIGA <>-1


	UPDATE FACTEXPDET
	SET PID_INDICEDLIGAR1 =-1
	FROM         FACTEXP INNER JOIN
	                      FACTEXPDET ON FACTEXP.FE_CODIGO = FACTEXPDET.FE_CODIGO 
	WHERE FACTEXP.PI_RECTIFICA = -1 AND PID_INDICEDLIGAR1 <>-1


	UPDATE CONFIGURACION
	SET CF_DESCARGAS='S'
	WHERE CF_DESCARGAS='I'


	UPDATE BOM_ARANCEL
	SET BA_GRAVABLE='S'
	WHERE BA_TIPOCOSTO IN ('1','6','8')


	/*UPDATE PIDescarga
	SET     PIDescarga.PID_COS_UNIDLS= PEDIMPDET.PID_COS_UNI
	FROM         PIDescarga INNER JOIN
	                      PEDIMPDET ON PIDescarga.PI_CODIGO = PEDIMPDET.PI_CODIGO AND PIDescarga.PID_INDICED = PEDIMPDET.PID_INDICED
	WHERE PIDescarga.PID_COS_UNIDLS= 0*/



























GO
