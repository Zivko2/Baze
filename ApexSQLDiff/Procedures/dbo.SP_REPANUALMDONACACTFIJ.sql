SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO







































CREATE PROCEDURE dbo.SP_REPANUALMDONACACTFIJ ( @DANCODIGO INT)   as

SET NOCOUNT ON 

DECLARE @MERCADONAC decimal(38,6), @MERCADONACdlls decimal(38,6)


/*if exists (select * 	FROM VREPANUALMDONACACTFIJ WHERE DAN_CODIGO=@DANCODIGO)
begin*/
		SELECT @MERCADONAC=SUM(VALOR), @MERCADONACdlls=SUM(PID_CTOT_DLS)
		FROM VREPANUALMDONACACTFIJ
		WHERE DAN_CODIGO=@DANCODIGO
		GROUP BY DAN_CODIGO 

	
	
		UPDATE DECANUALNVA
		SET DAN_MERCADONACACTFIJ= isnull(floor(round(@MERCADONAC,0)/1000),0),  DAN_MERCADONACACTFIJUSD= isnull(floor(round(@MERCADONACdlls, 0)/1000),0)
		WHERE DECANUALNVA.DAN_CODIGO = @DANCODIGO
	

/*end
else
begin
	UPDATE DECANUALNVA
	SET DAN_MERCADONACACTFIJ=0,  DAN_MERCADONACACTFIJUSD= 0
	WHERE DECANUALNVA.DAN_CODIGO = @DANCODIGO

end*/






































GO
