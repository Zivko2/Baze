SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO







































CREATE PROCEDURE dbo.SP_REPANUALIMPDEFMAT ( @DANCODIGO INT)   as

SET NOCOUNT ON 

DECLARE @IMPDEFINITIVAS decimal(38,6), @IMPDEFINITIVASdlls decimal(38,6)


/*if exists (select * FROM VREPANUALIMPDEFMAT WHERE     DAN_CODIGO = @DANCODIGO)
begin*/


SELECT     @IMPDEFINITIVAS= SUM(VALOR), @IMPDEFINITIVASdlls=SUM(DLLS)
FROM         VREPANUALIMPDEFMAT
WHERE     DAN_CODIGO = @DANCODIGO
GROUP BY DAN_CODIGO


	UPDATE DECANUALNVA
	SET DAN_IMPDEFINITIVASMAT = isnull(floor(round(@IMPDEFINITIVAS, 0)/1000),0), DAN_IMPDEFINITIVASMATUSD= isnull(floor(round(@IMPDEFINITIVASdlls, 0)/1000),0)
	WHERE DECANUALNVA.DAN_CODIGO = @DANCODIGO


/*end
else
begin
	UPDATE DECANUALNVA
	SET DAN_IMPDEFINITIVASMAT=0, DAN_IMPDEFINITIVASMATUSD=0
	WHERE DECANUALNVA.DAN_CODIGO = @DANCODIGO

end

*/






































GO
