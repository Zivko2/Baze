SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO





























CREATE PROCEDURE [dbo].[SP_temp_13033]   as



				UPDATE dbo.PERMISO
			SET     dbo.PERMISO.PE_CANT= isnull((SELECT SUM(PED_CANT) FROM PERMISODET
							WHERE PERMISODET.PE_CODIGO=PERMISO.PE_CODIGO
							GROUP BY PE_CODIGO),0),
			dbo.PERMISO.PE_COSTOT= isnull((SELECT     SUM(PED_COSTOT)
							FROM PERMISODET
							WHERE PERMISODET.PE_CODIGO=PERMISO.PE_CODIGO
							GROUP BY PE_CODIGO),0)


			exec sp_ReestructuraSaldosPermisos


			UPDATE PEDIMPDET
			SET     PID_COS_UNIGEN =ROUND(PID_CTOT_DLS / PID_CAN_GEN, 6) 
			WHERE PID_COS_UNIGEN <>ROUND(PID_CTOT_DLS / PID_CAN_GEN, 6) 
			AND PID_CAN_GEN>0
			
			UPDATE PEDIMPDET
			SET     PID_COS_UNIADU= ROUND(PID_VAL_ADU / PID_CAN_GEN, 6) 
			WHERE PID_COS_UNIADU<> ROUND(PID_VAL_ADU / PID_CAN_GEN, 6)
			AND PID_CAN_GEN>0




























GO
