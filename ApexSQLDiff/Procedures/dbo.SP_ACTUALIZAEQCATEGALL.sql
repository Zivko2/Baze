SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO


CREATE PROCEDURE [dbo].[SP_ACTUALIZAEQCATEGALL]   as

SET NOCOUNT ON 
DECLARE @ME_KILOGRAMOS int

	select @ME_KILOGRAMOS=ME_KILOGRAMOS from configuracion



	UPDATE dbo.MAESTROCATEG
	SET     dbo.MAESTROCATEG.EQ_CANT= dbo.EQUIVALE.EQ_CANT 
	FROM         dbo.MAESTRO INNER JOIN
	                      dbo.MAESTROCATEG ON dbo.MAESTRO.MA_CODIGO = dbo.MAESTROCATEG.MA_CODIGO INNER JOIN
	                      dbo.CATEGPERMISO ON dbo.MAESTROCATEG.CPE_CODIGO = dbo.CATEGPERMISO.CPE_CODIGO INNER JOIN
	                      dbo.EQUIVALE ON dbo.MAESTRO.ME_COM = dbo.EQUIVALE.ME_CODIGO1 AND dbo.CATEGPERMISO.ME_CODIGO = dbo.EQUIVALE.ME_CODIGO2

	UPDATE dbo.MAESTROCATEG
	SET     dbo.MAESTROCATEG.EQ_CANT= dbo.MAESTRO.MA_PESO_KG
	FROM         dbo.MAESTRO INNER JOIN
	                      dbo.MAESTROCATEG ON dbo.MAESTRO.MA_CODIGO = dbo.MAESTROCATEG.MA_CODIGO INNER JOIN
	                      dbo.CATEGPERMISO ON dbo.MAESTROCATEG.CPE_CODIGO = dbo.CATEGPERMISO.CPE_CODIGO
	WHERE  dbo.MAESTRO.MA_PESO_KG > 0 AND dbo.CATEGPERMISO.ME_CODIGO=@ME_KILOGRAMOS

	UPDATE dbo.MAESTROCATEG
	SET     dbo.MAESTROCATEG.EQ_CANT= 1
	FROM         dbo.MAESTRO INNER JOIN
	                      dbo.MAESTROCATEG ON dbo.MAESTRO.MA_CODIGO = dbo.MAESTROCATEG.MA_CODIGO INNER JOIN
	                      dbo.CATEGPERMISO ON dbo.MAESTROCATEG.CPE_CODIGO = dbo.CATEGPERMISO.CPE_CODIGO
	WHERE  dbo.MAESTRO.MA_PESO_KG = 0 AND dbo.CATEGPERMISO.ME_CODIGO=@ME_KILOGRAMOS



GO
